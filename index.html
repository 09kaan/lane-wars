<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Warlords: Direct Touch</title>
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
    <style>
        :root { --wood: #5d4037; --gold: #ffd700; --grass: #388e3c; }
        * { -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body {
            background: #121212; color: #fff; font-family: 'MedievalSharp', cursive;
            margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden;
        }

        #top-ui {
            background: var(--wood); padding: 10px; display: flex; justify-content: space-around;
            border-bottom: 4px solid #2d1b18; font-size: 1.2rem;
        }

        #game-container { flex-grow: 1; position: relative; background: var(--grass); }
        canvas { display: block; width: 100%; height: 100%; }

        #bottom-ui {
            background: #3e2723; padding: 10px; border-top: 4px solid #2d1b18;
            display: flex; flex-direction: column; align-items: center; gap: 8px;
        }

        .unit-tray { display: flex; gap: 15px; }
        .unit-card {
            background: #795548; border: 3px solid #5d4037; border-radius: 12px;
            width: 80px; height: 90px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; cursor: pointer;
        }
        .unit-card.active { border-color: var(--gold); background: #8d6e63; transform: scale(1.1); }
        .unit-card span { font-size: 2rem; }
        .unit-card b { font-size: 0.8rem; color: var(--gold); }

        .hint { font-size: 0.8rem; color: #a1887f; }
    </style>
</head>
<body>

<div id="top-ui">
    <div style="color:var(--gold)">üí∞ <span id="gold">200</span></div>
    <div style="color:#42a5f5">üè∞ <span id="p-hp">100</span></div>
    <div style="color:#ef5350">üëπ <span id="e-hp">100</span></div>
</div>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>
</div>

<div id="bottom-ui">
    <div class="unit-tray">
        <div class="unit-card active" id="u-sw" onclick="selected='swordsman'; updateUI()"><span>‚öîÔ∏è</span><b>25G</b></div>
        <div class="unit-card" id="u-ar" onclick="selected='archer'; updateUI()"><span>üèπ</span><b>40G</b></div>
        <div class="unit-card" id="u-kn" onclick="selected='knight'; updateUI()"><span>üõ°Ô∏è</span><b>80G</b></div>
    </div>
    <div class="hint">G√∂ndermek istediƒüin kulvara dokun!</div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let gold = 200, pHp = 100, eHp = 100, selected = 'swordsman', units = [], arrows = [], gameOver = false;

    const TYPES = {
        swordsman: { hp: 120, spd: 1.8, cost: 25, icon: '‚öîÔ∏è', range: 25 },
        archer:    { hp: 70,  spd: 1.4, cost: 40, icon: 'üèπ', range: 200 },
        knight:    { hp: 400, spd: 1.0, cost: 80, icon: 'üõ°Ô∏è', range: 30 }
    };

    function resize() {
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // DOKUNMATƒ∞K VE TIKLAMA KONTROL√ú
    function handleInput(e) {
        if(gameOver) return;
        const rect = canvas.getBoundingClientRect();
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        const y = clientY - rect.top;
        const lane = Math.floor(y / (canvas.height / 5));
        spawn(lane);
    }

    canvas.addEventListener('mousedown', handleInput);
    canvas.addEventListener('touchstart', (e) => { e.preventDefault(); handleInput(e); });

    class Unit {
        constructor(lane, type, team) {
            this.lane = lane; this.team = team; this.type = type;
            const d = TYPES[type];
            this.hp = d.hp; this.max = d.hp; this.spd = team === 'p' ? d.spd : -d.spd;
            this.icon = d.icon; this.range = d.range;
            this.x = team === 'p' ? -50 : canvas.width + 20;
            const lh = canvas.height / 5;
            this.y = (lane * lh) + (lh/2) - 20;
            this.lastAtk = 0; this.dead = false;
        }
        draw() {
            ctx.font = "35px serif";
            ctx.textAlign = "center";
            ctx.fillText(this.icon, this.x + 20, this.y + 30);
            ctx.fillStyle = "#000"; ctx.fillRect(this.x, this.y - 12, 40, 5);
            ctx.fillStyle = this.team === 'p' ? "#2196f3" : "#f44336";
            ctx.fillRect(this.x, this.y - 12, (this.hp/this.max)*40, 5);
        }
        update() {
            let blocked = false, target = null;
            for(let u of units) {
                if(u !== this && u.lane === this.lane && !u.dead) {
                    let d = this.team === 'p' ? (u.x - (this.x+30)) : (this.x - (u.x+30));
                    if(d > 0 && d < this.range) {
                        if(u.team !== this.team) { blocked = true; target = u; }
                        else { blocked = true; }
                    }
                }
            }
            if(!blocked) this.x += this.spd;
            else if(target && Date.now() - this.lastAtk > 1000) {
                if(this.type === 'archer') arrows.push({x:this.x+(this.team==='p'?40:-10), y:this.y+20, t:this.team, d:false});
                else target.hp -= 20;
                this.lastAtk = Date.now();
            }
            if(this.team === 'p' && this.x > canvas.width) { eHp -= 10; this.dead = true; }
            if(this.team === 'e' && this.x < -40) { pHp -= 10; this.dead = true; }
            if(this.hp <= 0) this.dead = true;
        }
    }

    function spawn(l) {
        if(gold >= TYPES[selected].cost) {
            gold -= TYPES[selected].cost;
            units.push(new Unit(l, selected, 'p'));
            updateUI();
        }
    }

    function updateUI() {
        document.getElementById('gold').innerText = Math.floor(gold);
        document.getElementById('p-hp').innerText = pHp;
        document.getElementById('e-hp').innerText = eHp;
        document.querySelectorAll('.unit-card').forEach(c => c.classList.remove('active'));
        const idMap = {swordsman:'sw', archer:'ar', knight:'kn'};
        document.getElementById('u-' + idMap[selected]).classList.add('active');
        
        if(pHp <= 0 || eHp <= 0) {
            gameOver = true;
            alert(pHp <= 0 ? "ORDUN D√ú≈ûT√ú!" : "ZAFER SENƒ∞NDƒ∞R!");
            location.reload();
        }
    }

    setInterval(() => { if(!gameOver) { gold += 5; updateUI(); } }, 1000);
    setInterval(() => {
        if(gameOver) return;
        const t = ['swordsman','archer','knight'][Math.floor(Math.random()*3)];
        units.push(new Unit(Math.floor(Math.random()*5), t, 'e'));
    }, 3200);

    function loop() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        // Kulvar √áizgileri
        ctx.strokeStyle = "rgba(255,255,255,0.1)";
        for(let i=1; i<5; i++) {
            ctx.beginPath(); ctx.moveTo(0, i*(canvas.height/5)); ctx.lineTo(canvas.width, i*(canvas.height/5)); ctx.stroke();
        }

        arrows.forEach(a => {
            a.x += a.t === 'p' ? 8 : -8;
            ctx.fillStyle = "white"; ctx.fillRect(a.x, a.y, 10, 2);
            units.forEach(u => {
                if(u.team !== a.t && Math.abs(a.x - u.x) < 20 && Math.abs(a.y - u.y) < 40) { u.hp -= 25; a.d = true; }
            });
        });
        arrows = arrows.filter(a => !a.d && a.x > 0 && a.x < canvas.width);
        units = units.filter(u => !u.dead);
        units.forEach(u => { u.update(); u.draw(); });
        if(!gameOver) requestAnimationFrame(loop);
    }
    loop();
</script>
</body>
</html>
