<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warlords: Call to Arms Clone</title>
    <style>
        body { background: #1a1a1a; color: #ddd; font-family: 'Georgia', serif; margin: 0; display: flex; flex-direction: column; align-items: center; user-select: none; }
        #game-container { position: relative; width: 900px; margin-top: 20px; border: 5px solid #444; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        canvas { background: #2d3436; display: block; background-image: linear-gradient(#333 1px, transparent 1px); background-size: 100% 80px; }
        #ui-bottom { width: 900px; background: #2c3e50; padding: 15px; box-sizing: border-box; display: flex; justify-content: space-around; border-top: 4px solid #34495e; }
        .unit-card { background: #34495e; border: 2px solid #7f8c8d; padding: 10px; border-radius: 5px; text-align: center; cursor: pointer; transition: 0.2s; width: 120px; }
        .unit-card:hover { border-color: #f1c40f; background: #2c3e50; }
        .unit-card.active { border-color: #f1c40f; box-shadow: 0 0 15px #f1c40f; }
        .cost { color: #f1c40f; font-weight: bold; display: block; }
        #stats { position: absolute; top: -45px; width: 100%; display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: bold; text-shadow: 2px 2px #000; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="stats">
        <span style="color: #f1c40f;">Altın: <span id="gold">150</span></span>
        <span style="color: #e74c3c;">Kale: <span id="p-hp">100</span> | Rakip: <span id="e-hp">100</span></span>
    </div>
    <canvas id="gameCanvas" width="900" height="400"></canvas>
</div>

<div id="ui-bottom">
    <div class="unit-card active" id="card-swordsman" onclick="selectUnit('swordsman')">
        <b>Piyade</b>
        <span class="cost">25G</span>
        <small>[Q]</small>
    </div>
    <div class="unit-card" id="card-archer" onclick="selectUnit('archer')">
        <b>Okçu</b>
        <span class="cost">40G</span>
        <small>[W]</small>
    </div>
    <div class="unit-card" id="card-knight" onclick="selectUnit('knight')">
        <b>Şövalye</b>
        <span class="cost">75G</span>
        <small>[E]</small>
    </div>
    <div style="align-self: center; font-size: 0.9rem; color: #bdc3c7;">
        <b>KONTROL:</b><br>1-5 Tuşları ile Gönder
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    let gold = 150;
    let playerHp = 100;
    let enemyHp = 100;
    let selectedType = 'swordsman';
    let units = [];
    let arrows = [];

    const UNIT_TYPES = {
        swordsman: { hp: 120, speed: 1.5, cost: 25, range: 10,  atkSpd: 800,  color: '#3498db', type: 'melee' },
        archer:    { hp: 70,  speed: 1.2, cost: 40, range: 250, atkSpd: 1500, color: '#2ecc71', type: 'ranged' },
        knight:    { hp: 400, speed: 0.8, cost: 75, range: 15,  atkSpd: 1200, color: '#f1c40f', type: 'melee' }
    };

    class Arrow {
        constructor(x, y, targetTeam) {
            this.x = x; this.y = y; this.targetTeam = targetTeam;
            this.speed = targetTeam === 'e' ? 7 : -7;
            this.damage = 25;
            this.dead = false;
        }
        draw() {
            ctx.fillStyle = "#fff";
            ctx.fillRect(this.x, this.y, 10, 2);
        }
        update() {
            this.x += this.speed;
            if (this.x < 0 || this.x > canvas.width) this.dead = true;
            units.forEach(u => {
                if (u.team === this.targetTeam && !u.dead) {
                    if (this.x > u.x && this.x < u.x + u.w && Math.abs(this.y - (u.y + u.h/2)) < 20) {
                        u.hp -= this.damage;
                        this.dead = true;
                    }
                }
            });
        }
    }

    class Unit {
        constructor(lane, type, team) {
            this.lane = lane; this.team = team; this.type = type;
            const data = UNIT_TYPES[type];
            this.hp = data.hp; this.maxHp = data.hp;
            this.speed = team === 'p' ? data.speed : -data.speed;
            this.range = data.range;
            this.atkSpd = data.atkSpd;
            this.lastAtk = 0;
            this.w = type === 'knight' ? 40 : 30;
            this.h = type === 'knight' ? 40 : 30;
            this.x = team === 'p' ? -50 : canvas.width + 10;
            this.y = (lane * 80) + 40 - (this.h / 2);
            this.dead = false;
        }

        draw() {
            ctx.fillStyle = this.team === 'p' ? '#3498db' : '#e74c3c';
            if (this.type === 'knight') ctx.strokeStyle = "#f1c40f"; else ctx.strokeStyle = "#fff";
            ctx.lineWidth = 2;
            ctx.strokeRect(this.x, this.y, this.w, this.h);
            ctx.fillRect(this.x, this.y, this.w, this.h);
            
            // Can Barı
            ctx.fillStyle = 'red'; ctx.fillRect(this.x, this.y - 10, this.w, 5);
            ctx.fillStyle = 'lime'; ctx.fillRect(this.x, this.y - 10, (this.hp/this.maxHp)*this.w, 5);
        }

        update() {
            let canMove = true;
            let target = null;

            for (let other of units) {
                if (other !== this && other.lane === this.lane && !other.dead) {
                    let dist = this.team === 'p' ? (other.x - (this.x + this.w)) : (this.x - (other.x + other.w));
                    if (dist > 0 && dist < this.range) {
                        if (this.team !== other.team) {
                            canMove = false;
                            target = other;
                        } else { canMove = false; } // Kendi birimine takılma
                    }
                }
            }

            if (canMove) this.x += this.speed;
            else if (target && Date.now() - this.lastAtk > this.atkSpd) {
                if (this.type === 'archer') {
                    arrows.push(new Arrow(this.x + (this.team === 'p' ? 30 : 0), this.y + 15, this.team === 'p' ? 'e' : 'p'));
                } else {
                    target.hp -= 20;
                }
                this.lastAtk = Date.now();
            }

            if (this.team === 'p' && this.x > canvas.width) { enemyHp -= 10; this.dead = true; }
            if (this.team === 'e' && this.x < -40) { playerHp -= 10; this.dead = true; }
            if (this.hp <= 0) this.dead = true;
        }
    }

    function spawn(lane, team, type) {
        if (team === 'p') {
            if (gold >= UNIT_TYPES[type].cost) {
                gold -= UNIT_TYPES[type].cost;
                units.push(new Unit(lane, type, 'p'));
            }
        } else {
            units.push(new Unit(lane, type, 'e'));
        }
        updateUI();
    }

    function selectUnit(type) {
        selectedType = type;
        document.querySelectorAll('.unit-card').forEach(c => c.classList.remove('active'));
        document.getElementById('card-' + type).classList.add('active');
    }

    window.addEventListener('keydown', e => {
        if (e.key >= 1 && e.key <= 5) spawn(e.key - 1, 'p', selectedType);
        if (e.key === 'q') selectUnit('swordsman');
        if (e.key === 'w') selectUnit('archer');
        if (e.key === 'e') selectUnit('knight');
    });

    function updateUI() {
        document.getElementById('gold').innerText = gold;
        document.getElementById('p-hp').innerText = playerHp;
        document.getElementById('e-hp').innerText = enemyHp;
    }

    setInterval(() => { gold += 5; updateUI(); }, 2000);
    setInterval(() => {
        const types = ['swordsman', 'archer', 'knight'];
        spawn(Math.floor(Math.random()*5), 'e', types[Math.floor(Math.random()*3)]);
    }, 4000);

    function loop() {
        ctx.clearRect(0,0,canvas.width, canvas.height);
        
        // Lane Çizgileri
        ctx.strokeStyle = "#444";
        for(let i=1; i<5; i++) {
            ctx.beginPath(); ctx.moveTo(0, i*80); ctx.lineTo(900, i*80); ctx.stroke();
        }

        arrows = arrows.filter(a => !a.dead);
        arrows.forEach(a => { a.update(); a.draw(); });

        units = units.filter(u => !u.dead);
        units.forEach(u => { u.update(); u.draw(); });

        if (playerHp > 0 && enemyHp > 0) requestAnimationFrame(loop);
        else {
            ctx.fillStyle = "rgba(0,0,0,0.8)";
            ctx.fillRect(0,0,900,400);
            ctx.fillStyle = "#fff";
            ctx.font = "50px Arial";
            ctx.textAlign = "center";
            ctx.fillText(playerHp <= 0 ? "GAME OVER" : "VICTORY", 450, 200);
        }
    }
    loop();
</script>
</body>
</html>
